# Write Some Scheme

é’ˆå¯¹åˆšåˆšå®ç°çš„è§£é‡Šå™¨çš„æµ‹è¯•å¹¶ä¸ç®—å¾ˆå®Œå–„ï¼Œæ‰€ä»¥åœ¨è‡ªå·±çš„å®ç°ä¸­å¯èƒ½æœ‰æœªå‘ç°çš„ bugï¼Œæ‰€ä»¥è¿™é˜¶æ®µå°±æ˜¯è‡ªå·±å†™ä¸€äº› `Scheme Code`ï¼Œå…ˆåœ¨ [61A Code (cs61a.org)](https://code.cs61a.org/) è¿è¡ŒæˆåŠŸåå†å»è‡ªå·±çš„è§£é‡Šå™¨ä¸­è¿è¡Œ



#### Scheme Editor

åœ¨ç¼–è¾‘è‡ªå·±çš„ `Scheme Code` çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡ `Scheme Editor` è¿›è¡Œ `Debug` æ“ä½œ

```shell
python editor

# localhost:31415
```

ä¸€å®šè¦æ–°å¼€ä¸€ä¸ª `powershell` æ¥æ‰§è¡Œ `python ok` æµ‹è¯•ï¼Œå¦åˆ™ä¼šä¸­æ­¢ `Scheme Editor` çš„è¿è¡Œï¼Œå¦‚æœå‘ç°ä½ çš„ä»£ç å¯ä»¥è¿è¡Œåœ¨ `Scheme Editor` ä½†æ˜¯åœ¨è‡ªå·±å®ç°çš„è§£é‡Šå™¨ä¸­ä¸èƒ½ï¼Œè¯´æ˜è‡ªå·±çš„å®ç°çš„è§£é‡Šå™¨ä¸­å‡ºäº† bugï¼Œfix it



Tipï¼šæˆ‘æœ€å¼€å§‹æƒ³ç€ç”¨ç½‘ç«™æµ‹è¯•å°±å¥½ï¼Œä½†æ˜¯ä¸è¡Œå•Šï¼Œå¾ˆå¤š `Buildin Procedure` æ²¡æœ‰ï¼Œåªèƒ½ç”¨ `Scheme Editor` 

â•°ï¼ˆâ€µâ–¡â€²ï¼‰â•¯



### Problem 16

```shell
python ok -q 16 --local
```

å®ç° `enumerate` å‡½æ•°ï¼Œæ¥æ”¶ä¸€åˆ—å€¼ç„¶åè¿”å›ä¸€ä¸ªç”± `()` ç»„æˆçš„åˆ—è¡¨

first elementï¼šthe index of the value list

second elementï¼šthe value itself

é¢˜ç›®è¿˜æç¤ºäº†ä¸¤ä¸ªåŠŸèƒ½å‡½æ•° `cons-all()` å’Œ `zip()` ç”¨åœ¨ `enumerate()` ä¸­ï¼Œå°±æ˜¯æˆ‘æ²¡ä»€ä¹ˆæ€è·¯....

ï¼ˆç®€å•çœ‹äº†çœ‹ï¼Œå‘ç°åé¢çš„æˆ‘å¥½åƒéƒ½ä¸å¤ªä¼šå•Š... o.0		è¦ä¸ä½ ç›´æ¥æ€äº†æˆ‘è¿™æ ·æ›´ç®€å•



æˆ‘æƒ³ä¸å‡ºæ¥è¿™ä¸ª `index` çš„å˜é‡æ€ä¹ˆå¤„ç†ï¼Œæƒ³å‡ºæ¥äº†ï¼Œå†™ä¸ªå­å‡½æ•°

```scheme
(define (enumerate s)
  (define (inner sub-index lst)
    
    (if (null? lst)
        nil
        (cons
         	(cons sub-index (cons (car lst) nil))
         	(cons (inner (+ 1 sub-index) (cdr lst)) nil)
        )
    )
  )
  (inner 0 s)
)

(enumerate '(1 2))

; ((0 1) ((1 2) ()))
; emm.. ç»“æ„ä¸Šå’Œç­”æ¡ˆè¦æ±‚çš„æœ‰æ ¹æœ¬ä¸Šçš„ä¸åŒ ç­”æ¡ˆçš„ Pair æ˜¯å¹³çº§çš„ ä½†æ˜¯æˆ‘çš„å®ç°æ˜¯æœ‰å±‚æ¬¡çš„
; æˆ‘ä¹Ÿæƒ³ä¸å¤ªåˆ°äº† emm...	å»çœ‹çœ‹ç­”æ¡ˆ
```

```scheme
(define (enumerate s)
  ; BEGIN PROBLEM 16
  (define (helper s i ans)
      (if (null? s)
         ans
        (helper (cdr s) (+ i 1) (append ans (list (list i (car s)))))
      )
  )
  (helper s 0 nil)
)

; æ²¡æœ‰æ„è¯†åˆ°æœ‰ä¸ª append æ–¹æ³• emm... å¥½æ°”
; åœ¨ Buildin æ–‡ä»¶ä¸­è¿˜çœŸçš„æœ‰ append() æ–¹æ³• æˆ‘ä¸ä¼šè¦æŠŠè¿™äº›å‡½æ•°å…¨éƒ½çœ‹ä¸€éå§æˆ‘è¶… (â€¾â—¡â—)?

; (append [lst] ...)
(append '(1 2 3) '(4 5 6))
(1 2 3 4 5 6)

; ä¸è¿‡é€šè¿‡ ans è¾…åŠ©å˜é‡æ¥æ‰§è¡Œå°¾é€’å½’æ˜¯æˆ‘æ²¡æƒ³åˆ°çš„
; ç­”æ¡ˆå†™çš„çœŸä¸é”™ ç»“æ„æ¸…æ™° å¥½çƒ¦ æˆ‘æ€ä¹ˆå†™ä¸å‡ºæ¥
```

[Scheme Built-In Procedure Reference | CS 61A Summer 2020 (berkeley.edu)](https://inst.eecs.berkeley.edu/~cs61a/su20/articles/scheme-builtins.html) å¾ˆé‡è¦çš„å‚è€ƒ

æ³¨æ„æ„é€  `(index value)` ç»“æ„çš„æ—¶å€™ï¼Œéœ€è¦è°ƒç”¨ä¸¤æ¬¡ `list()` 



### Problem 17

```shell
python ok -q 17 --local
```

å°±æ˜¯é‚£ç§å¾ˆå…¸å‹çš„ï¼Œèµ°å°é˜¶é—®é¢˜ï¼Œè¿™å‡ é“ç»ƒä¹ é¢˜æˆ‘è¦ yue äº†ï¼Œæˆ‘ä¸ä¼šæˆ‘çœŸçš„ä¸ä¼šå•Šå‘œå‘œå‘œå‘œå‘œå‘œ

åˆšå¼€å§‹ç”¨ Python å†™è¿™ç±»é—®é¢˜æˆ‘å°±ä¸å¤ªè¡Œï¼Œè¿˜æŒ‡æœ›æˆ‘ç”¨ scheme å†™... o(ï¿£â”°ï¿£*)ã‚	ä¸ä¼šä¸ä¼šï¼Œæ”¾å¼ƒ

------

å‡½æ•°è¦æ±‚ä¸¤ä¸ªå‚æ•° `total` å’Œ `denoms` 

totalï¼šè¡¨ç¤ºéœ€è¦ç”¨é›¶é’±å‡‘é½çš„ç›®æ ‡æ•°é¢

denomsï¼šè¡¨ç¤ºå½“å‰æ‹¥æœ‰çš„é›¶é’±çš„é¢é¢ï¼Œæ¯ç§é¢é¢çš„é›¶é’±æ•°é‡æ— é™

é¢˜ç›®æç¤ºç”¨ `BuildinProcudure Map()` æ¥å®ç°è¾…åŠ©å‡½æ•° `cons-all()`ï¼ŒæŠŠ `elem-first` æ‹¼æ¥åˆ°æ¯ä¸ªå­åˆ—è¡¨é¦–ä½

```scheme
(cons-all 1 
          '( (2 3) (4 5) (6 7) )
)

> ( (1 2 3)
    (1 4 5)
    (1 6 7)
   )
```

æœ€åè¾“å‡ºç»“æœçš„æ—¶å€™æç¤ºç”¨ `BuildinProceudre Append()` è¾“å‡º

------

ç›´æ¥å¼€å§‹åˆ†æç­”æ¡ˆ

é¦–å…ˆæ˜¯ä¸¤ç§ç‰¹æ®Šæƒ…å†µçš„åˆ†æï¼š

- total == 0ï¼šæ²¡æœ‰é›¶é’±éœ€è¦æ‰¾ï¼Œç›´æ¥è¿”å›ç©º
- denoms == 0ï¼šæ²¡æœ‰é›¶é’±å¯ä»¥æ‰¾ï¼Œç›´æ¥è¿”å›ç©º

ä¸€èˆ¬æƒ…å†µï¼š

æ³¨æ„é¢˜ç›®ç»™å‡ºçš„é›¶é’±é¢é¢åºåˆ—æ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥å¯ä»¥ä¾æ¬¡åˆ†æï¼Œå¦‚æœå½“å‰çš„é›¶é’±é¢é¢å¤§äºæ‰¾é’±é¢é¢ï¼Œè®¤ä¸ºæ— æ•ˆï¼Œå»æ‰¾ä¸‹ä¸€ä¸ªï¼Œå¦åˆ™ï¼Œä½¿ç”¨ `two path` çš„é€’å½’æ€è·¯ï¼Œæ‹†åˆ†æˆåŒ…å«è¯¥é›¶é’±é¢é¢çš„ç»„åˆ + ä¸åŒ…å«è¯¥é›¶é’±é¢é¢çš„ç»„åˆ

```scheme
(define (cons-all first rests)
  (map
    (lambda (x)
      (append (list first) x)
    )
    rests
  )  
)

;; Problem 17
;; List all ways to make change for TOTAL with DENOMS
(define (list-change total denoms)
  ; BEGIN PROBLEM 17
  ; é¦–å…ˆå¤„ç†ç‰¹æ®Šæƒ…å†µ
  (if (eq? 0 total)
    (list nil)
    (if (null? denoms)
      ; æ³¨æ„ denoms æ˜¯ä¸€ä¸ªåˆ—è¡¨ åˆ¤æ–­æ–¹å¼ä¼šä¸å¤ªä¸€æ ·
      nil
      ; two path method
      (if (<= (car denoms) total)
        ; å½“å‰çš„é›¶é’±é¢é¢å¯ä»¥ç”¨æ¥æ‰¾é’±
        (append
          (cons-all (car denoms) (list-change (- total (car denoms)) denoms)) ; é’ˆå¯¹å½“å‰å…ƒç´ å¯ä»¥å…‘æ¢æ•°é¢çš„éå†
          (list-change total (cdr denoms))  ; å‰©ä½™å…ƒç´ çš„éå†æƒ…å†µ
        )
        ; å½“å‰çš„é¢é¢ä¸å¯ä»¥ç”¨æ¥æ‰¾é’±
        ; è¿™é‡Œæœ‰ä¸ªè¦æ±‚æ˜¯ denoms åˆ—è¡¨å¿…é¡»æ˜¯é™åºæ’åº
        (list-change total (cdr denoms))
      )
    )
  )
  ; END PROBLEM 17
)
```

è™½ç„¶è¯´æ˜¯çœ‹ç­”æ¡ˆäº†ï¼Œä½†æ˜¯å’Œä¹‹å‰é‚£å‡ é“ç›¸ä¼¼çš„ Python ä¾‹é¢˜æ¯”èµ·æ¥å¼ºå¤šäº†ï¼Œè¿™æ¬¡çš„æ€è·¯å¯ä»¥å¾ˆæ¸…æ™°çš„é¡ºä¸‹æ¥ï¼Œä¹‹å‰å°±æ˜¯çœ‹ç­”æ¡ˆéƒ½è¦æŠ˜ç£¨å¥½ä¹…23333

ï¼ˆæˆ‘ä¼°è®¡æˆ‘ä¸‹ä¸€é“é¢˜ä¹Ÿåšä¸å‡ºæ¥å°±æ˜¯äº†...



### Problem 18

```shell
python ok -q 18 -u --local
```

å¼ºè°ƒ scheme ä¸­ç¨‹åºå³æ•°æ®çš„æ¦‚å¿µï¼Œå®ç°ç±»ä¼¼äº `Python eval()` çš„åŠŸèƒ½

é¢˜ç›®ä¸¾äº†ä¸ªä¾‹å­ï¼ŒæŠŠ `let function` è½¬åŒ–åˆ° `lambda function` å»è¡¨ç¤ºï¼Œå¾—åˆ°ç›¸åŒç»“æœï¼Œæ ¸å¿ƒæ˜¯æ–°å»ºä¸€ä¸ªå‡½æ•°å¸§

æ ¹æ®è¿™ä¸€ç‚¹ï¼Œå®ç° `let-to-lambda` åŠŸèƒ½ï¼Œé‡å†™æ‰€æœ‰çš„ `let` ç‰¹æ®Šå½¢å¼ï¼Œè½¬æ¢åˆ° `lambda expr` ï¼ˆåŒ…æ‹¬å¼•å·æƒ…å†µ

å› ä¸º scheme expr æœ¬èº«æ˜¯é€’å½’çš„ï¼Œæ‰€ä»¥è½¬æ¢ä¹Ÿè¦é€’å½’è¡¨è¾¾

```scheme
(let-to-lambda 1)
; 1

(let-to-lambda '(+ 1 2))
; (+ 1 2)

(let-to-lambda '(lambda (x) (+ 1 x)))
; (lambda (x) (+ 1 x))

(let-to-lambda '(let ((a 1)) (let ((b a)) b)))
; ((lambda (a) ((lambda (b) b) a)) 1)
```



ï¼ˆé¢˜ç›®æç¤ºè¯´ï¼Œå…¶å®å°±æ˜¯ç”¨ scheme å»å†™ä¸€ä¸ª `scheme_eval()` ï¼Œä¸ç”¨è€ƒè™‘ `quasiquotation` 

è¾…åŠ©å‡½æ•°ï¼šä½¿ç”¨ `BuildinProcedure Map()` å®ç° `zip()`ï¼ŒæŠŠå¯¹åº”ä½ç½®çš„å…ƒç´ æ‹¼æˆä¸€ä¸ªæ–°åˆ—è¡¨



æˆ‘è§‰å¾—æ ¸å¿ƒè¿˜æ˜¯æ„é€ æ•°æ®ç»“æ„ï¼Œåªæ˜¯åœ¨ scheme é‡Œé¢ï¼Œè¯¥æ•°æ®ç»“æ„ç¢°å·§ä¸ºæ‰§è¡Œè¯­å¥



Qï¼šåœ¨æ‰§è¡Œæµ‹è¯•è¯­å¥ `(let-to-lambda '(+ 1 2))` çš„æ—¶å€™ä¸çŸ¥é“ä¸ºä»€ä¹ˆæ²¡æœ‰è¿›å…¥ `quote branch` åè€Œè¿›å…¥ `else-branch` 

å¯¹äºåŸå­æ“ä½œï¼Œæ¯”å¦‚å˜é‡æˆ–è€…æ•°å­—ç›´æ¥è¿”å› `expr` å°±å¯ä»¥ä½†æ˜¯å³ä½¿èµ°å¯¹äº†åˆ†æ”¯ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“è¯¥å¦‚ä½•è¿”å›

å°è¯•è¿‡ `(display expr)` ä½†æ˜¯æ‰“å°å‡ºæ¥çš„æ˜¯åŒ…å«è¾“å…¥çš„å®Œæ•´è¯­æ³•ï¼Œå¦‚æœæ˜¯ `(display (car expr))` æ˜¯ `+` 



MDï¼Œè¿™ä¸ª Phase5 æˆ‘è¿‘ä¹æ˜¯æ”¾å¼ƒçš„çŠ¶æ€ï¼Œè¿™ä¸ªä¹Ÿæ˜¯æä¸å®š23333ï¼Œåªèƒ½è¯´è‡ªå·±ç†è§£ä¹‹åä¼šé»˜ç€å†™ä¸€é

------



æˆ‘å…ˆæ˜¯çœ‹äº†çœ‹è¿™ä¸ª zip çš„å®ç°ï¼Œæœ‰ç‚¹å°å°çš„å±€é™æ€§ï¼Œåªä¼šå¯¹ä¸€åˆ—å­åˆ—è¡¨çš„å‰ä¸¤ä¸ªå…ƒç´ è¿›è¡Œå¤„ç†ï¼Œåˆå¹¶å‡ºåªå«æœ‰ä¸¤ä¸ªå­åˆ—è¡¨çš„åˆ—è¡¨ï¼Œæ— æ³•å¯¹æœ‰ 3 ä¸ªå…ƒç´ çš„å­åˆ—è¡¨èµ·ä½œç”¨ï¼ˆåº”è¯¥æ˜¯å’Œ zip åœ¨æœ¬é¢˜çš„ä½œç”¨èŒƒå›´æœ‰å…³

```scheme
(zip '((1 2 3) (4 5 6) (7 8 9)))
> ((1 4 7) (2 5 8))

(zip '((1 2) (3 4) (5 6)))
> ((1 3 5) (2 4 6))

; ç»“æœåªæœ‰ä¸¤ä¸ªå­åˆ—è¡¨
```

é¢˜è§£ç»™å‡ºçš„ zip å®ç°ä¹ŸæŒºå·§å¦™çš„ï¼Œä½¿ç”¨ `tail recursion` å®ç°

emmm... æˆ‘æ²¡æœ‰ç†è§£é¢˜è§£çš„ `let-to-lambda()` çš„åˆ†æ”¯åˆ¤æ–­ï¼Œæ‰€ä»¥æˆ‘è§‰å¾—è¿™é“é¢˜çš„å®ç°æ˜¯æœ‰ç‚¹é—®é¢˜çš„.......

> ä¸å¯¹ï¼Œè¿˜æ˜¯æ²¡é—®é¢˜çš„ï¼Œæˆ‘çš„é”…ï¼Œæ²¡æœ‰å¯¹ `lambda-branch` è¿›è¡Œè·Ÿè¸ªÃ—



![](./let-structure.png)



æ³¨æ„è§‚å¯Ÿ `let-expr` çš„å­˜å‚¨ç»“æ„

```scheme
(car expr) = let
params = (car (cdr expr))	; ((a 1) (b 2))
body = (cdr (cdr expr))		; (+ a b)
; è¿™é‡Œå°±æ¶‰åŠåˆ° zip å¯¹ä¸¤ä¸ªå‚æ•°çš„å¤„ç† å¾—åˆ° para-list å’Œ value-list
; åˆ†åˆ«æ”¾å…¥ lambda-expr ç»“æ„çš„å¯¹åº”ä½ç½®
```



**Qï¼š** `lambda expr` çš„å­˜å‚¨å±‚æ¬¡

```scheme
top: (list value)	(list 1 2)
list: (lambda params body)
params: (a (b nil))		body: (operator operands)

; æ¯”è¾ƒç–‘æƒ‘çš„æ˜¯ lambda å­—ç¬¦å¤–é¢è¦å¥—ä¸¤å±‚ cons æˆ‘ä¸ç†è§£ ä¸ºä»€ä¹ˆ
; ä»è¡¨è¾¾å¼çœ‹ lambda å¤–å±‚æœ‰ä¸¤ä¸ªæ‹¬å· ä½†æ˜¯ä»å­˜å‚¨ç»“æ„çœ‹å®ƒåˆåœ¨ç¬¬ä¸€å±‚

(append
    (cons
      (cons
        'lambda 
        (cons formal (map let-to-lambda body))
      )
      nil
    )
    (map let-to-lambda value)	; return scheme list
)

; åŒçº§ä¹‹é—´å¯ä»¥ç”¨ cons è¿æ¥(ä¹Ÿå°±æ˜¯ lambda é‚£ä¸€ä¸²) é‚£åˆ°åº•æ˜¯ä»€ä¹ˆå¯¼è‡´äº†å­˜å‚¨å±‚æ¬¡çš„å·®å¼‚
; append æœ¬èº«è™½ç„¶æ˜¯åŒçº§è¿æ¥ æœ¬èº«ä¸æ¶‰åŠ cons æ„é€  æœ€å¤–å±‚çš„ cons æ˜¯ä¸ºäº†å®¹çº³åé¢çš„ value

(append '(1 2 3) '(2 4))
; (1 2 3 2 4)

(append (cons 1 (cons 2 (cons 3 nil))) (cons 2 (cons 4 nil)))
; (1 2 3 2 4)

(append (cons (cons 1 (cons 2 (cons 3 nil))) nil) (cons 2 (cons 4 nil)))
; ((1 2 3) 2 4)
; append ä¼šæ·»åŠ åœ¨ lst1 çš„æœ«å°¾ nil ä½ç½®

; æ‰€ä»¥æˆ‘ç–‘æƒ‘çš„ä¸æ˜¯æœ¬èº«çš„ç»“æ„é—®é¢˜ è€Œæ˜¯ append() çš„ä½¿ç”¨
```



**Qï¼š**ä¸ºä»€ä¹ˆ `lambda expr` å’Œ `define expr` çš„è¯­æ³•å®šä¹‰ä¸åŒä½†æ˜¯å¯ä»¥ä½¿ç”¨ç›¸åŒçš„åˆ†æ”¯æ„é€ 

æ ¸å¿ƒå°±åœ¨äºè™½ç„¶å½¢å¼çœ‹ä¸Šå»ä¸åŒï¼Œä½†æ˜¯ç»“æ„æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ„é€ æ–¹å¼

```scheme
(lambda (param)
	(body)
)

(define (func-name param)
	(body)
)
```



**Qï¼š**åœ¨ Debug çš„è¿‡ç¨‹ä¸­å‡ºç°äº†ä¸€ä¸ªéå¸¸ç¦»è°±çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯ scheme çš„å‡½æ•°è°ƒç”¨çš„é—®é¢˜ï¼Œè™½ç„¶æˆ‘ç°åœ¨è¿˜ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œä½†æ˜¯ç›´æ¥è°ƒç”¨ `(caar lst)` å’Œ `(car (car lst))` è¿”å›çš„åˆ—è¡¨ç»“æ„ä¸åŒ

æˆ‘é©¬è™äº†ï¼Œè‰¹ï¼Œæ²¡çœ‹æ¸…åé¢é‚£ä¸ª second æ˜¯è°ƒç”¨äº†ä¸‰å±‚ï¼Œæˆ‘çš„æˆ‘çš„ã„Ÿ( â–”, â–” )ã„

```scheme
; zip
(helper
 	(cdr lst)
 	(append first (list (car (car lst))))
 	(append second (list (cdr (car lst))))
)

; ((lambda (a b) (+ a b)) (1) (2))
```

 

```shell
python ok -q 18 --local
```



# Phase5 Pass!

è¿™ï¼Œå—¯... ä¹Ÿä¸å¥½è¯´æ˜¯æˆ‘è‡ªå·±å†™å®Œçš„ï¼Œè™½ç„¶é¢˜æ˜¯è¿‡äº†ä¸€éï¼Œä½†æ˜¯æŠ„ç­”æ¡ˆå¯èƒ½ä¹Ÿä¸ç®—å†™å®Œ2333

ï¼ˆä¸è¿‡æ€»ç®—æ˜¯å®Œæˆäº†å˜›ï¼Œè™½ç„¶ä¸‹ä¸€èŠ‚æˆ‘è‚¯å®šä¹Ÿåšä¸å‡ºæ¥ğŸ‘¾
